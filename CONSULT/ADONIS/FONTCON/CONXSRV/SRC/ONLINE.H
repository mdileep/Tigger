/************************************************************************
 *
 *     Copyright (c) 1992 Adonis Corporation.  All Rights Reserved.
 *
 *-----------------------------------------------------------------------
 *
 *      Module:  online.h
 *
 ***********************************************************************/

#ifndef _ONLINE_H_
#define _ONLINE_H_

extern HWND     hdlgOnline ;

UINT WINAPI OnlineFSM( HWND hwnd, UINT uiFunc ) ;

BOOL WINAPI StartOnlineDialog( VOID ) ;
BOOL WINAPI EndOnlineDialog( VOID ) ;
VOID WINAPI SetOnlineStatusMsg( LPSTR lpsz ) ;

VOID WINAPI ShowOnlineDownloadStuff( HWND hDlg, BOOL f ) ;
VOID WINAPI SetDownloadPercent( HWND hDlg, UINT u ) ;
VOID WINAPI UpdateOnlineDialog( HWND hwnd ) ;

#include "fsm.h"
/*
 * Connect dialog FSM
 */
typedef struct tagONLINEFSM
{
   FSM_HEADER ;

//   BOOL     fEndMessageCall ;       // When true we return from SendBBSMsg()

   BYTE     bSendMsg ;              // The message being processed.

   LPBYTE   lpSend ;                // Pointer to Send buffer
   DWORD    cbSend ;                // Number of bytes to Send
   BOOL     fSendCRC ;              // Use CRC check on outgoing data?
   BOOL     fSendPad ;              // Pad data before sending

   LPBYTE   lpReceive ;             // Pointer to receive buffer
   DWORD    cbReceive ;             // Number of bytes to receive
   BOOL     fReceiveCRC ;           // Use CRC check on incomming data?
   BOOL     fReceivePad ;           // Un Pad incomming data

   UINT     uiReSyncAttempts ;      // Count of resync attempts.
   UINT     uiReSendAttempts ;      // Count of message resend attempts.
   UINT     uiSavedNextState ;      // Save the uiNextState during resync

} ONLINEFSM, *PONLINEFSM, FAR *LPONLINEFSM ;

#define PADCHAR      '~'

/* The Online Finite State Machine changes states every
 * ONLINE_DRIVE_MSEC milliseconds.  The timer that does this
 * is created in FF_ONLINE_INITFSM and the WM_TIMER is translated into
 * calls to OnlineFSM() in the main window procedure
 */
#define IDTIMER_ONLINE_FSM       11         // some arbitrary number

/*
 * Forced functions for the OnlineFSM (non-messages)
 *
 * All non-message forced functions have the high-bit set to
 * distinguish them from message functions (messages.h).
 */
#define FF_ONLINE_PROCESS          0x8000
#define FF_ONLINE_INITFSM          0x8001
#define FF_ONLINE_EXITFSM          0x8002
#define FF_ONLINE_ABORT            0x8003
#define FF_ONLINE_USERABORT        0x8004


/*
 * States for the Online FSM
 */
#define STATE_ONLINE_IDLE                  0x0000
#define STATE_ONLINE_EXITFSM               0x0001
#define STATE_ONLINE_PAUSE                 0x0002
#define STATE_ONLINE_WAITACK               0x0003
#define STATE_ONLINE_ERROR                 0x0004
#define STATE_ONLINE_SENDMSG               0x0005
#define STATE_ONLINE_SENDDATA_WAITRECEIVE  0x0006
#define STATE_ONLINE_SENDDATA_WAITACK      0x0007
#define STATE_ONLINE_WAITRECEIVE           0x0008
#define STATE_ONLINE_FATALABORT            0x0009
#define STATE_ONLINE_RESYNC                0x000a
#define STATE_ONLINE_RESYNC_WAITACK        0x000b
#define STATE_ONLINE_CONXPRO_RECEIVE        0x000c


/* Exit codes generated by the state machine.  If all is going well
 * all that will ever come up is EXITCODE_OK.
 *
 * Each of these exit codes has an error string associated with
 * it.  these strings are defined in CONXSRV.str.  Any changes
 * made here must also be made in CONXSRV.str (look for the
 * IDS_ERR_EC_* defines.
 */
#define EXITCODE_OK                 0x0000
#define EXITCODE_ACK_BAD            0x0001
#define EXITCODE_ACK_TIMEOUT        0x0002
#define EXITCODE_LOSTCONNECTION     0x0003
#define EXITCODE_RECEIVE_TIMEOUT    0x0004
#define EXITCODE_RECEIVE_CRC        0x0005
#define EXITCODE_GENERALFAILURE     0x0006
#define EXITCODE_RECEIVE_FILE       0x0007
#define EXITCODE_NAK                0x0008
#define EXITCODE_DISKSPACE          0x0009
#define EXITCODE_HOSTCANCEL         0x000a


#endif

/************************************************************************
 * End of File: online.h
 ***********************************************************************/

